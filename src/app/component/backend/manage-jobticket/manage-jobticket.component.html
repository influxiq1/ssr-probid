<div class="adminwrappercls">
  <app-header></app-header>
  <div class="main-content-wrap">
    <mat-card-content class="adm_inner_banner">
      <mat-card-title class="adm_inner_title">manage jobticket</mat-card-title>
      <p class="adm_inner_para">Lorem Ipsum is simply dummy text of the printing and typesetting industry.</p>
    </mat-card-content>
    <mat-card-content class="bred_cram_wrapper">
      <a mat-list-item routerLinkActive="active"> Dashboard </a>
      <a mat-list-item routerLinkActive="active activebread">manage jobticket</a>
    </mat-card-content>
    <mat-card class="generalcls managejobticket" style="padding:0px !important">
      <span class="mainwrappercontent">
        <span class="searchblock rsvpsearch">
          <span class="searchblockwrapper">
            <span >
              <h2 *ngIf="job_ticket !=null" >
                {{job_ticket.Fullname}}</h2> &nbsp;   
             
              <h2 *ngIf="job_ticket !=null && job_ticket._id !=null"> [ Ticket Id : {{job_ticket._id}} ] </h2>
              <span class="statusjobticket">
                <mat-label *ngIf="job_ticket !=null ">Status :</mat-label>                
  

                 <button mat-button class="btnblue greenbtn" 
                *ngIf="job_ticket !=null && job_ticket !=''  && job_ticket.job_ticket_status == 3 " >Re-Opened</button>

                <button mat-button class="btnblue redbtn" 
                *ngIf="job_ticket !=null && job_ticket !='' && job_ticket.job_ticket_status == 2 ">Closed</button>

                

                <button mat-raised-button type="reset" class="btnblue greenbtn" 
                *ngIf="job_ticket != null && job_ticket.job_ticket_status == 0">Open</button>

                <button mat-raised-button type="reset" class="btnblue greenbtn" 
                *ngIf="job_ticket != null && job_ticket.job_ticket_status == 1">Replied By Admin</button>

              </span>
            </span>

            <span class="statusjobticket">
              <span *ngIf="userCookies.type == 'admin'">
                <button mat-raised-button type="reset" class="btnblue" 
              (click)="jobTicketStatus(job_ticket._id,2)" 
              *ngIf="job_ticket !=null && job_ticket.job_ticket_status == 0 || job_ticket.job_ticket_status == 1  ||job_ticket.job_ticket_status == 3 ">Mark As Resolved</button>
              </span>
              


              <button mat-raised-button type="reset" class="btnblue"
               (click)="jobTicketStatus(job_ticket._id,3)" *ngIf="job_ticket !=null 
               && job_ticket.job_ticket_status == 2 " >Re-Open</button>
            </span>
            
          </span>
        </span>
        <span class="adm_dashboard_block1">
          <span class="adm_dashboard_block1_left">
            <span class="bluebg">
              <span class="sectionheader">Car RSVP Info</span>
            </span>
            <mat-list role="list" class="flexbox1column">
              <mat-list-item role="listitem" class="rsvplistsingle">
                <!-- <span (click)="deleteAny(item._id,i,'rsvp')" class="deletecls"><i class="material-icons">delete</i></span> -->
                <span class="rsvplistsingleinner">
                  <span class="rsvplistsingleleft">
                    <span class="rsvpliststop">
                      <span class="rsvplistimgwrapper">
                        <!-- <img *ngIf="item.media.photo_links[0] != null" 
                                          [src]="item.media.photo_links[0]" (click)="viewRsvpDetails(item._id)"> -->
                        <!-- <img class="defaultimg" *ngIf="item.media.photo_links[0] == null" src="assets/images/no-image-default.jpg"> -->
                        <img class="defaultimg" *ngIf="rsvp_details.car_image !=null"
                          [src]="rsvp_details.car_image">
                        <img class="defaultimg" *ngIf="rsvp_details.car_image =='' || rsvp_details.car_image ==null"
                          src="assets/images/no-image-default.jpg">
                        
                      </span>
                    </span>
                    <span class="rsvplistsbottom">
                      <!-- <h2 (click)="viewRsvpDetails(item._id)">{{item.heading}}</h2> -->
                      <h2>{{rsvp_details.heading}}</h2>
                      <span class="rsvplistsbottombtm">
                        <span>RSVP Status</span>

                        <span *ngIf="rsvp_details.status == 2  " class="btnactive">Rejected <span class="colorred"></span></span>
                                
                        <span *ngIf="rsvp_details.status == 1"  class="btnactive">Accepted <span class="colorgreen"></span></span>
                       

                        <span *ngIf="rsvp_details.status == 0" class="btnactive">Pending <span class="coloryellow"></span></span>
                        <!-- <span class="btnactive">Accepted <span class="colorgreen"></span></span> -->
                      </span>
                    </span>
                  </span>
                  <span class="rsvplistsingleright">
                    <span class="rsvplisttypecontent">
                      <h2>User</h2>
                      <span class="rsvplisttypecontentinfo">
                        <span class="rsvplisttypeimgwrapper">

                          <span *ngIf="rsvp_details.added_for_picture !=null">
                            <img [src]="rsvp_details.added_for_picture"></span> 
                            <span *ngIf="rsvp_details.added_for_picture ==null">
                             <img src="../../../../assets/images/no-image-default.jpg"></span> 
                        </span>
                        <span class="listscontent">
                          <mat-list>
                            <!-- <mat-list-item><span class="labelcls">Name:</span> <span>{{item.added_for_fullname}}</span> </mat-list-item> -->
                            <!-- <mat-list-item><span class="labelcls">Email ID:</span> <span>{{item.added_for_email}}</span> </mat-list-item> -->
                            <!-- <mat-list-item><span class="labelcls">Phone:</span> <span>{{item.added_for_phone}}</span> </mat-list-item> -->
                            <mat-list-item><span class="labelcls">Name:</span>
                              <span>{{rsvp_details.added_for_fullname}}</span> </mat-list-item>
                            <mat-list-item><span class="labelcls">Email ID:</span>
                              <span>{{rsvp_details.added_for_email}}</span> </mat-list-item>
                          </mat-list>

                        </span>
                      </span>
                    </span>
                    <span class="rsvplisttypecontent">
                      <h2>Salesrep</h2>
                      <span class="rsvplisttypecontentinfo">
                        <span class="rsvplisttypeimgwrapper">
                          

                          <span *ngIf="rsvp_details.added_by_picture !=null">
                            <img [src]="rsvp_details.added_by_picture"></span> 
                            <span *ngIf="rsvp_details.added_by_picture ==null">
                             <img src="../../../../assets/images/no-image-default.jpg"></span> 

                        </span>
                        <span class="listscontent">
                          <mat-list>
                            <!-- <mat-list-item><span>Name:</span> <span>{{item.added_by_fullname}}</span> </mat-list-item>
                                                 <mat-list-item><span>Email ID:</span> <span>{{item.added_by_email}}</span> </mat-list-item> -->
                            <!-- <mat-list-item><span>Phone:</span> <span>{{item.added_by_phone}}</span> </mat-list-item> -->
                            <mat-list-item><span class="labelcls">Name:</span> <span>{{rsvp_details.added_by_fullname}}</span>
                            </mat-list-item>
                            <mat-list-item><span class="labelcls">Email ID:</span> <span>{{rsvp_details.added_by_email}}</span>
                            </mat-list-item>
                          </mat-list>
                        </span>
                      </span>
                    </span>
                    <span class="rsvplisttypebottom">
                      <span class="singlespan">
                        <!-- <span *ngIf="userCookies.type == 'admin'">       -->
                        <!-- <button mat-button class="btnblue greenbtn" *ngIf=" (item.status != 1) && item.status == 0 || item.status == 2" (click)="changeStatus(item, 1)">Accept</button>      
                                          <button *ngIf="item.status == 1 " (click)="openModale(item)" mat-button class="btnblue whitebtn">Send Email To Customer</button>  
                                        <button mat-button class="btnblue yellowbtn" *ngIf="item.status != 1 && item.status == 2" (click)="changeStatus(item, 0)">Pending</button>  
                                        <button mat-button class="btnblue redbtn" *ngIf="item.status == 0 && item.status != 1" (click)="changeStatus(item, 2)">Reject</button> -->
                        <!-- </span> -->
                        <span>
                          <!-- <button mat-button class="btnblue whitebtn">Send Email To Customer</button>
                          <button mat-button class="btnblue redbtn">Reject</button> -->
                          <button mat-button class="btnblue greenbtn"
                          *ngIf=" rsvp_details.status == 0 || rsvp_details.status == 2" 
                          (click)="changeStatus(rsvp_details, 1)">Accepted</button>
            
            
                          <!-- <button  *ngIf="rsvp_details.status == 1 " (click)="openModale(rsvp_details)" mat-button class="btnblue whitebtn">Send Email To Customer</button> -->
            
                         <button mat-button class="btnblue yellowbtn" *ngIf="rsvp_details.status == 1 && rsvp_details.status == 2" 
                         (click)="changeStatus(rsvp_details, 0)">Pending</button>
            
                         <button mat-button class="btnblue redbtn" 
                         *ngIf="rsvp_details.status == 0 && rsvp_details.status == 1" (click)="changeStatus(rsvp_details, 2)">Rejected</button>
                        </span>
                        <!-- <button mat-button class="btnblue orangebtn" (click)="viewJobTicket(item)">View ticket</button>
                                        <button mat-button class="btnblue" (click)="viewRsvpDetails(item._id)">Know More</button> -->
                        <!-- <button mat-button class="btnblue" (click)="rsvpDetail(item._id)">Know More</button> -->
                      </span>
                      <span class="dateadded">
                        <strong>Added Date:</strong> {{rsvp_details.date_added}}
                      </span>
                    </span>
                  </span>
                </span>
              </mat-list-item>
            </mat-list>
          </span>

          <span class="adm_dashboard_block1_right">

            <span *ngIf="status != 1">
              <form [formGroup]="jobTicketForm" >
                <span class="bluebg">
                  <!-- <span class="sectionheader">Car RSVP Info</span> -->
                  <mat-form-field *ngIf="status != 1">
                    <textarea matInput placeholder="Subject" formControlName="subject" cols="50" (blur)="inputUntouched('subject')"></textarea>
                  </mat-form-field>
                  <!-- <ng-container *ngIf="status == 1 && job_ticket != null && job_ticket != undefined && job_ticket.subject != null">
                    <div class="subjectcls">
                      <p>{{job_ticket.subject}}</p> 
                    </div>
                  </ng-container>                 -->
                </span>
                <span  class="whitebg">
                  <!-- <span class="sectionheader"></span> -->
                  <span class="graybg">
                    <mat-form-field class="example-full-width" *ngIf="status != 1 ">
                      <textarea matInput placeholder="Description" formControlName="description" (blur)="inputUntouched('description')"></textarea>
                    </mat-form-field>
                    <ng-container *ngIf="status == 1 && job_ticket != null && job_ticket.description != undefined">
                      <p >{{job_ticket.description}}</p>
                    </ng-container>
                  </span>
                  <mat-list  class="jobticketimglists">
                    <lib-file-upload [config]="configData" class="file_upload"></lib-file-upload>
                    <ng-container *ngIf="job_ticket !='' && job_ticket !=null && job_ticket.jobTicket_picture != null && job_ticket.jobTicket_picture != ''">
                      <mat-list-item *ngFor="let item of job_ticket.jobTicket_picture">
                        <img *ngIf="job_ticket.jobTicket_picture != null" class="defaultimg" [attr.src]="item.basepath+''+item.fileservername">
                      </mat-list-item>
                    </ng-container>
                    <ng-container *ngIf="job_ticket =='' || job_ticket ==null || job_ticket.jobTicket_picture == null || job_ticket.jobTicket_picture == '' ">
                    <mat-list-item *ngIf="status != 0">
                      <!-- <img  class="defaultimg" src="assets/images/no-image-default.jpg"> -->
                    </mat-list-item>
                  </ng-container>
                  </mat-list>
                  <span class="dateadded">
                   
                  </span>
                  <span class="statusjobticket">
                    <button mat-raised-button type="button" class="btnblue"
                     (click)="jobTicketFormSubmit()">Submit</button>
                    <!-- <button mat-raised-button type="submit" class="btnblue">Reply</button> -->
                  </span>
                </span>              
              </form>
            </span>

              <span class="whitebg jobcommentbox" *ngIf="status == 1 ">
                <mat-list class="commentboxscroll">
                  <ng-container>
                      <mat-list-item>
                        <span class="toppart jobcommentbox">
                          <span class="sectionheader">
                            <mat-card-title *ngIf="job_ticket !=null"><span class="subject">Subject:</span><span class="title">{{job_ticket.subject}}</span> </mat-card-title>
                          </span>
                          <span class="jobcommentboximg">
                            <img class="defaultimg" *ngIf="job_ticket==null "src="../../../../assets/images/default_car_img.jpeg">
                            <img class="defaultimg"  *ngIf="job_ticket!=null &&job_ticket.profile_picture != null && job_ticket.profile_picture != ''"
                             [attr.src]="job_ticket.profile_picture">
                          </span>
                          <span class="jobcommentboxcontent" >
                            <mat-card-title *ngIf="job_ticket !=null">{{job_ticket.Fullname}} <span *ngIf="job_ticket !=null">Date: {{job_ticket.date}}</span></mat-card-title>
                            <mat-card-content *ngIf="job_ticket !=null">{{job_ticket.description}}</mat-card-content>
                          </span>   
                        </span>
                        <span class="toppart">
                          <span class="msgblock" *ngIf="job_ticket !=null">
                            <mat-list class="jobticketimglists"  >
                              <ng-container *ngFor="let item of job_ticket.jobTicket_picture">
                              <mat-list-item *ngIf="job_ticket !=null &&  job_ticket.jobTicket_picture != null && job_ticket.jobTicket_picture != '' && job_ticket.jobTicket_picture != undefined && item != null" >
                                <img (click)="viewImage(item)"class="defaultimg" [src]="item">
                                <!-- <img *ngIf="job_ticket ==null &&job_ticket.jobTicket_picture == '' || job_ticket.jobTicket_picture == null || job_ticket.jobTicket_picture == undefined" class="defaultimg" src="../../../../assets/images/no-image-default.jpg"> -->
                              </mat-list-item>
                            </ng-container>
                            </mat-list>
                          </span>
                        </span>
                    </mat-list-item>
                    
                      <mat-list-item *ngFor="let item of message_details" class="msgblockwrapper">
                        <span class="msgblock">
                          <span class="jobcommentboximg">
                            <img class="defaultimg" *ngIf="item.profile_picture == null || item.profile_picture == undefined"  src="assets/images/no-image-default.jpg">
                            <img class="defaultimg" *ngIf="item!=null &&item.profile_picture != null && item.profile_picture != ''" [attr.src]="item.profile_picture">
                      <!-- <mat-list-item *ngFor="let item of contract_details">
                        <span class="jobcommentboximg">
                          <img class="defaultimg" *ngIf="item.profile_picture == null || item.profile_picture == undefined" src="assets/images/no-image-default.jpg">
                          <img class="defaultimg" *ngIf="item.profile_picture != null && item.profile_picture != ''" [attr.src]="item.profile_picture">                       -->
                        </span>
                        <span class="jobcommentboxcontent" >
                          <mat-card-title>{{item.fullname}} <span>Date: {{item.date}}</span></mat-card-title>
                          <mat-card-content>{{item.message}}</mat-card-content>
                          <!-- <h6 style="text-align: left;"><strong>Date: </strong> {{item.date}}</h6> -->
                        </span>  
                      </span>
                      <span class="msgblock" *ngIf="item.msg_picture !=null && item.msg_picture !=''">
                        <mat-list class="jobticketimglists">
                          <mat-list-item *ngFor="let jobImage of item.msg_picture">
                            <img *ngIf="item.msg_picture !=null && item.msg_picture !='' && jobImage"  class="defaultimg" [src]="jobImage" (click)="viewJobImage(jobImage)">  
                            <!-- <img class="defaultimg" *ngIf="item.msg_picture == null || item.msg_picture == undefined"  src="assets/images/no-image-default.jpg"> -->
                          </mat-list-item>
                        </mat-list>
                      </span>                 
                    </mat-list-item>

                  </ng-container>
                </mat-list> 
              </span>
              <!-- <form *ngIf="showbox!=0"  [formGroup]="jobTicketMsgForm" (ngSubmit)="jobTicketMsgFormSubmit()"> -->
                <!-- *ngIf="job_ticket !=null && job_ticket !='' && job_ticket.job_ticket_status !=null && job_ticket.message_flag != 2 " -->
                <span >
            <span  *ngIf="job_ticket !=null && job_ticket.job_ticket_status !=2 ">
                <form [formGroup]="jobTicketMsgForm"  *ngIf="status == 1 ">
                  <span class="whitebg" > 
                    <mat-form-field>
                      <span class="commentbox">
                        <input matInput placeholder="Comment...." formControlName="message" cols="50" rows="4" (blur)="inputValUntouched('message')">
                      </span>
                      <mat-list class="jobticketimglists">
                          <lib-file-upload [config]="configDataJobTicket" class="file_upload"></lib-file-upload>
                      </mat-list>  
                      <span class="statusjobticket">
                        <button mat-raised-button type="button" class="btnblue" 
                        (click)="jobTicketMsgFormSubmit(job_ticket._id,1)" *ngIf="userCookies.type=='admin'">SEND</button>

                        <button mat-raised-button type="button" class="btnblue" 
                        (click)="jobTicketMsgFormSubmit(job_ticket._id,0)" *ngIf="userCookies.type =='salesrep' || 
                        userCookies.type=='customer'">SEND</button>
                        <button mat-raised-button type="reset" class="btnblue redbtn">cancel</button>
                      </span>                  
                    </mat-form-field>
                  </span>
                </form>
              </span>
            </span>
              <span *ngIf="job_ticket !=null && job_ticket !=''&& job_ticket.job_ticket_status == 2 " class="markasresolvedadmincls redbtn">Mark as resolved from admin</span>
          </span>
        </span>
      </span>
    </mat-card>
  </div>
</div>

<app-footer></app-footer>
